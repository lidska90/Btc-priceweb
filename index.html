  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BTCUSDT Live S/R & Liquidations</title>
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { margin:0; background:#111; color:#eee; font-family:sans-serif; }
    #chart { height: 90vh; }
    #info { padding:10px; }
    button { margin-right: 10px; }
  </style>
</head>
<body>
  <div id="info">
    <button onclick="changeInterval('1m')">1m</button>
    <button onclick="changeInterval('5m')">5m</button>
    <button onclick="changeInterval('1h')">1h</button>
    <button onclick="changeInterval('1d')">1d</button>
    <span id="status">Connecting...</span>
  </div>
  <div id="chart"></div>

  <script>
    let chart = LightweightCharts.createChart(document.getElementById('chart'), {
      layout: { background: { color: '#111' }, textColor: '#ddd' },
      grid: { vertLines: { color: '#333' }, horzLines: { color: '#333' } },
      timeScale: { borderColor: '#555' },
      rightPriceScale: { borderColor: '#555' }
    });

    let candleSeries = chart.addCandlestickSeries();
    let liquidationSeries = chart.addScatterSeries({
      color: 'red',
      symbol: 'circle',
      size: 6
    });

    let interval = '1m';
    let wsKline, wsLiq;

    function connectStreams() {
      if (wsKline) wsKline.close();
      if (wsLiq) wsLiq.close();

      wsKline = new WebSocket(`wss://fstream.binance.com/ws/btcusdt@kline_${interval}`);
      wsKline.onmessage = e => {
        let msg = JSON.parse(e.data);
        let k = msg.k;
        candleSeries.update({
          time: k.t / 1000,
          open: parseFloat(k.o),
          high: parseFloat(k.h),
          low: parseFloat(k.l),
          close: parseFloat(k.c)
        });
      };

      wsLiq = new WebSocket(`wss://fstream.binance.com/ws/btcusdt@forceOrder`);
      wsLiq.onmessage = e => {
        let msg = JSON.parse(e.data);
        let o = msg.o;
        let side = o.S; // BUY / SELL
        let price = parseFloat(o.ap);
        let qty = parseFloat(o.q);

        liquidationSeries.update({
          time: o.T / 1000,
          position: price,
          color: side === 'BUY' ? 'lime' : 'red',
          size: Math.min(10, 4 + qty * 10)
        });
      };

      document.getElementById('status').innerText = `Connected (${interval})`;
    }

    function changeInterval(newInterval) {
      interval = newInterval;
      connectStreams();
    }

    connectStreams();
  </script>
</body>
</html>
